# Nom du workflow qui appara√Ætra dans l'onglet "Actions" de GitHub.
name: PHP Quality Assurance

# D√©clencheurs : Quand ce workflow doit-il s'ex√©cuter ?
on:
  push:
    branches: [ "main" ] # √Ä chaque `git push` sur la branche `main`.
  pull_request:
    branches: [ "main" ] # √Ä chaque cr√©ation/mise √† jour d'une Pull Request vers `main`.

# Jobs : Les t√¢ches √† effectuer. Un workflow peut avoir plusieurs jobs.
jobs:
  # Job de build et de v√©rification qualit√©
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.3'
          tools: composer:v2
          coverage: xdebug

      - name: Install dependencies
        run: composer install --prefer-dist --no-progress

      - name: Fix permissions for php-cs-fixer
        run: chmod +x vendor/bin/php-cs-fixer

      - name: Fix permissions for phpstan
        run: chmod +x vendor/bin/phpstan

      - name: Fix permissions for phpunit
        run: chmod +x vendor/bin/phpunit

      - name: Run Linter (PHP-CS-Fixer)
        run: composer lint

      - name: Run Static Analysis (PHPStan)
        run: composer analyse

      - name: Tests unitaire + couverture
        run: composer test

      - name: Upload rapport de couverture
        uses: actions/upload-artifact@v4
        with:
          name: coverage-report
          path: build/coverage

  # Job de d√©ploiement simul√©
  deploy:
    needs: build
    runs-on: ubuntu-latest
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    steps:
      - name: üöÄ Simuler un d√©ploiement
        run: echo "Deploying to production..."
